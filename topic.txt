- name: Authenticate with GAR
  uses: google-github-actions/auth@35b0e87d162680511bf346c299f71c9c5c379033  # v1.1.1
  id: auth
  if: ${{ github.event.inputs.TEAM_PREFIX != '' && env.TEAM_PREFIX != '' }}
  with:
    token_format: access_token
    workload_identity_provider: 'projects/279795997641/locations/global/workloadIdentityPools/github-actions/providers/github-actions'
    service_account: 'sa-registry-${{ inputs.TEAM_PREFIX }}-push@${{ inputs.ARTIFACT_PROJECT }}.iam.gserviceaccount.com'
    access_token_lifetime: 600s
  continue-on-error: true
  if: always()
  run: |
    echo "Team Prefix: ${{ env.TEAM_PREFIX }}"
    if [ -z "${{ env.TEAM_PREFIX }}" ]; then
      echo "Error: TEAM_PREFIX is not available within the context."
      exit 1
    fi
    echo "Authentication successful."
